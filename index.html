<!DOCTYPE html>
<html>
  <head>
    <title>English word training</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div id="result"></div>
    <div id="inputSection">
      <button onclick="start()">start</button>
      <button  onclick="getTrainigHistory()">history</button>
    </div>
    <div id="currentWord"></div>
    <canvas id="myChart" width="1100" height="150"></canvas>

    <script>
      var input = `
            <input type="text" id="userInput" placeholder="write a word">
            <button id="btn" onclick="checkMessage()">check</button>
        `;
      var wordsArray = {
        a: 'o',
        about: 'despre',
        accept: 'accepta',
        // Добавьте другие слова в словарь
      };

      var keys = Object.keys(wordsArray);
      var falseCount = 0;
      var trueCount = 0;
      var currentWordIndex = 0;
      var currentWordDiv = document.getElementById('currentWord');

      function start() {
        var chart = document.getElementById('myChart');
        chart.style.display = 'none';
        if (currentWordIndex === 0) {
          currentWordDiv.innerHTML = `<h3>Current word: ${keys[currentWordIndex]}</h3>`;
        }
        inputSection.innerHTML = input;
        var btn = document.getElementById('btn');
        document.addEventListener('keypress', (event) => {
          // event.keyCode or event.which  property will have the code of the pressed key
          let keyCode = event.keyCode ? event.keyCode : event.which;

          // 13 points the enter key
          if (keyCode === 13) {
            // call click function of the buttonn
            btn.click();
          }
        });
      }

      function checkMessage() {
        var btn = document.getElementById('btn');
        document.addEventListener('keypress', (event) => {
          // event.keyCode or event.which  property will have the code of the pressed key
          let keyCode = event.keyCode ? event.keyCode : event.which;

          // 13 points the enter key
          if (keyCode === 13) {
            // call click function of the buttonn
            btn.click();
          }
        });

        var userInput = document.getElementById('userInput').value;
        var currentWord = wordsArray[keys[currentWordIndex]];

        var resultDiv = document.getElementById('result');
        var inputSection = document.getElementById('inputSection');

        currentWordIndex++;
        if (currentWordIndex < keys.length) {
          currentWordDiv.innerHTML = `<h3>Current word: ${keys[currentWordIndex]}</h3>`;
        }

        if (userInput === currentWord) {
          trueCount++;
          resultDiv.innerHTML = '<span style="color: green;">GJ!</span>';
        } else {
          falseCount++;
          resultDiv.innerHTML = `
                    <p style="color: red;">Wrong.</p>
                    <p>Correct word: ${currentWord}</p>
                `;
        }

        if (currentWordIndex < keys.length) {
          inputSection.innerHTML = input;
        } else {
          inputSection.innerHTML = 'Training is over';
          currentWordDiv.innerHTML = `
                    <p>Correct: ${trueCount}</p>
                    <p>Wrong: ${falseCount}</p>
                `;
          var date = new Date();
          var jsonRes = {
            correct: trueCount,
            wrong: falseCount,
            date:
              date.getDate() +
              '.' +
              (date.getMonth() + 1) +
              '.' +
              date.getFullYear() +
              ' ' +
              date.getHours() +
              ':' +
              date.getMinutes() +
              ':' +
              date.getSeconds(),
          };
          saveResultsOnServer(jsonRes);
        }
      }

      function saveResultsOnServer(jsonRes) {
        fetch('http://localhost:3000/saveResults', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(jsonRes),
        })
          .then((response) => {
            if (response.ok) {
              console.log('Results saved on server');
            } else {
              console.error('Failed to save results on server');
            }
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      }

      function getTrainigHistory() {
        fetch('http://localhost:3000/getTrainigHistory')
          .then((response) => {
            return response.json();в
          })
          .then((data) => {
            const dates = data.map((item) => item.date);
            const correct = data.map((item) => item.correct);
            const wrong = data.map((item) => item.wrong);

            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
              type: 'line', // Use a line chart
              data: {
                labels: dates,
                datasets: [
                  {
                    label: 'Correct Answers',
                    data: wrong,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false,
                  },
                  {
                    label: 'Wrong Answers',
                    data: correct,
                    borderColor: 'rgba(255, 11, 132, 1)',
                    borderWidth: 2,
                    fill: false,
                  },
                ],
              },
              options: {
                scales: {
                  x: {
                    display: true,
                    title: {
                      display: true,
                      text: 'Date',
                    },
                  },
                  y: {
                    beginAtZero: true,
                    display: true,
                    title: {
                      display: true,
                      text: 'Count',
                    },
                  },
                },
              },
            });
          });
      }

      function enterButton(){
        var btn = document.getElementById('btn');
        document.addEventListener('keypress', (event) => {
          // event.keyCode or event.which  property will have the code of the pressed key
          let keyCode = event.keyCode ? event.keyCode : event.which;

          // 13 points the enter key
          if (keyCode === 13) {
            // call click function of the buttonn
            btn.click();
          }
        });
      }
    </script>
  </body>
</html>
